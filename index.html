<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <section class="container">
    <div class="centered-image"><img src="asset/logo.png" alt="Logo" /></div>
    <!-- <header>ABSENSI PIKET</header> -->
    <form action="#" class="form" onsubmit="submitForm(event)">
      <div class="input-box">
        <label>Nama Lengkap</label>
        <input id="nama" type="text" placeholder="Masukkan nama lengkap" required />
      </div>
      <div class="column">
        <div class="input-box address">
          <label>Jabatan</label>
          <div class="select-box">
            <select id="jabatan" required>
              <option hidden>Pilih Jabatan</option>
              <option>PKD Batulawang</option>
              <option>PKD Ciburial</option>
              <option>PKD Cimaskara</option>
            </select>
          </div>
        </div>
      </div>
      <div class="column">
        <div class="input-box">
          <label>Jam Otomatis</label>
          <input id="jam-piket" type="time" readonly required />
        </div>
        <div class="input-box">
          <label>Tanggal Otomatis</label>
          <input id="tanggal-piket" type="date" readonly required />
        </div>
      </div>
      <div class="input-box-camera">
        <video id="camera" width="150" height="150" autoplay></video>
      </div>
      <button type="submit" id="submit-btn">Absen Sekarang</button>
    </form>
  </section>

  <script>
    // Mendapatkan alamat IP pengunjung
    function getIP(callback) {
      const url = 'https://api.ipify.org?format=json';

      fetch(url)
        .then(response => response.json())
        .then(data => {
          const ip = data.ip;
          callback(ip);
        });
    }

    function checkIP() {
      const allowedIP = '114.5.217.171'; // Ganti dengan alamat IP yang diperbolehkan

      getIP(ip => {
        if (ip !== allowedIP) {
          window.location.href = 'bolos.html';
        }
      });
    }

    window.onload = checkIP;

    var inputJam = document.getElementById("jam-piket");
    var waktuSaatIni = new Date();
    var jam = waktuSaatIni.getHours();
    var menit = waktuSaatIni.getMinutes();
    var waktuFormatted = (jam < 10 ? "0" + jam : jam) + ":" + (menit < 10 ? "0" + menit : menit);
    // Mengatur nilai input dengan waktu lokal
    inputJam.value = waktuFormatted;

    var inputTanggal = document.getElementById("tanggal-piket");
    var currentDate = new Date();
    var formattedDate = currentDate.toISOString().split("T")[0];
    inputTanggal.value = formattedDate;

    function submitForm(event) {
      event.preventDefault(); // Prevent the form from submitting normally
      var nama = document.getElementById('nama').value;
      var jabatan = document.getElementById('jabatan').value;
      var jampiket = document.getElementById('jam-piket').value;
      var tanggalpiket = document.getElementById('tanggal-piket').value;

      if (nama === '' || jabatan === '' || tanggalpiket === '' || jampiket === '') {
        alert('Mohon lengkapi semua field sebelum mengirim.');
      } else {
        // All fields are filled, redirect to "berhasil.html"
        window.location.href = 'berhasil.html';
      }
    }

    // Access the camera stream and display it in the <video> element
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(function (stream) {
        var video = document.getElementById('camera');
        video.srcObject = stream;
        video.play();
      })
      .catch(function (error) {
        console.log('Unable to access the camera: ', error);
      });
  </script>
</body>

</html>